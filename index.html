<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Qrestige PRO</title>

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.6.0/lib/qr-code-styling.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
body{
margin:0;
font-family:Tajawal;
background:#0d0f14;
color:#fff;
display:flex;
height:100vh;
}

aside{
width:340px;
background:#141622;
padding:20px;
overflow:auto;
}

h2{font-weight:900;margin-bottom:10px}

label{font-size:13px;opacity:.8}
input,select,button{
width:100%;
margin-top:6px;
margin-bottom:12px;
padding:10px;
border-radius:8px;
border:none;
font-family:inherit;
}

button{background:#7c7cff;color:#fff;font-weight:700;cursor:pointer}
button.secondary{background:#2a2d3d}

main{
flex:1;
display:flex;
justify-content:center;
align-items:center;
background:
radial-gradient(circle,rgba(255,255,255,.08) 1px,transparent 1px);
background-size:18px 18px;
}

.stage{
padding:40px;
background:#111;
border-radius:20px;
box-shadow:0 30px 80px rgba(0,0,0,.6);
position:relative;
transition:.3s;
}

.stage.transparent{
background:none;
box-shadow:none;
padding:0;
}

#safeZone{
position:absolute;
border:2px dashed red;
border-radius:50%;
pointer-events:none;
display:none;
}

.caption{
margin-top:16px;
font-weight:900;
font-size:22px;
text-align:center;
}
</style>
</head>

<body>

<aside>
<h2>Qrestige PRO</h2>

<label>Data</label>
<input id="data" value="https://example.com">

<label>Caption</label>
<input id="caption" value="SCAN ME">

<label>Gradient Start</label>
<input type="color" id="c1" value="#000000">

<label>Gradient End</label>
<input type="color" id="c2" value="#7c7cff">

<label>Logo</label>
<input type="file" id="logo">

<label>Logo Size (%)</label>
<input type="range" id="logoSize" min="10" max="40" value="25">

<label>Error Correction</label>
<select id="error">
<option value="L">L</option>
<option value="M">M</option>
<option value="Q">Q</option>
<option value="H" selected>H</option>
</select>

<label>Margin</label>
<input type="range" id="margin" min="0" max="20" value="6">

<label><input type="checkbox" id="transparent"> Absolute Transparency</label>
<label><input type="checkbox" id="safe"> Safe Zone Checker</label>

<button onclick="savePreset()">Save Preset</button>
<button class="secondary" onclick="loadPreset()">Load Preset</button>

<button onclick="exportPNG()">Export PNG</button>
<button onclick="exportPDF()">Export PDF</button>
<button onclick="exportSVG()">Export SVG</button>
</aside>

<main>
<div class="stage" id="stage">
<div id="qr"></div>
<div id="safeZone"></div>
<div class="caption" id="cap">SCAN ME</div>
</div>
</main>

<script>
let logoData=null;

const qr=new QRCodeStyling({
width:300,height:300,type:"canvas",
dotsOptions:{type:"extra-rounded"},
backgroundOptions:{color:"transparent"}
});

qr.append(document.getElementById("qr"));

function update(){
qr.update({
data:data.value,
image:logoData,
imageOptions:{
imageSize:logoSize.value/100,
margin:margin.value
},
qrOptions:{errorCorrectionLevel:error.value},
dotsOptions:{
gradient:{
type:"linear",
colorStops:[
{offset:0,color:c1.value},
{offset:1,color:c2.value}
]}
}
);

cap.textContent=caption.value;
cap.style.color=c1.value;

stage.classList.toggle("transparent",transparent.checked);

// Safe Zone
const sz=document.getElementById("safeZone");
if(safe.checked){
sz.style.display="block";
sz.style.width=qr._options.width*logoSize.value/100+"px";
sz.style.height=sz.style.width;
sz.style.top="50%";
sz.style.left="50%";
sz.style.transform="translate(-50%,-50%)";
}else sz.style.display="none";
}

document.querySelectorAll("input,select").forEach(e=>e.oninput=update);

logo.onchange=e=>{
const r=new FileReader();
r.onload=()=>{logoData=r.result;update();}
r.readAsDataURL(e.target.files[0]);
};

function savePreset(){
localStorage.qrestige=JSON.stringify({
data:data.value,caption:caption.value,
c1:c1.value,c2:c2.value,
logoSize:logoSize.value,error:error.value,margin:margin.value
});
alert("Preset Saved");
}

function loadPreset(){
const p=JSON.parse(localStorage.qrestige||"{}");
Object.assign(data,p);
caption.value=p.caption||caption.value;
c1.value=p.c1||c1.value;
c2.value=p.c2||c2.value;
logoSize.value=p.logoSize||logoSize.value;
error.value=p.error||error.value;
margin.value=p.margin||margin.value;
update();
}

async function exportPNG(){
const c=await html2canvas(stage,{scale:3,backgroundColor:null});
download(c.toDataURL(),"qrestige.png");
}

async function exportPDF(){
const c=await html2canvas(stage,{scale:4,backgroundColor:null});
const pdf=new jspdf.jsPDF({unit:"px",format:[c.width,c.height]});
pdf.addImage(c.toDataURL(),"PNG",0,0);
pdf.save("qrestige.pdf");
}

function exportSVG(){
qr.download({extension:"svg",name:"qrestige"});
}

function download(href,name){
const a=document.createElement("a");
a.href=href;a.download=name;a.click();
}

update();
</script>

</body>
</html>
