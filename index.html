<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>مولّد رمز QR احترافي</title>

  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700;900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; }
    body {
      margin: 0; min-height: 100vh;
      background: linear-gradient(135deg, #0f172a, #312e81);
      display: flex; align-items: center; justify-content: center;
    }
    .container {
      background: #fff; width: 100%; max-width: 1000px;
      border-radius: 24px; padding: 30px;
      box-shadow: 0 30px 60px rgba(0,0,0,0.3);
    }
    h1 { text-align: center; font-weight: 900; margin-bottom: 10px; }
    .subtitle { text-align: center; color: #6b7280; margin-bottom: 30px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
    @media (max-width: 768px){ .grid{ grid-template-columns:1fr;} }
    label { font-weight: 700; display: block; margin-bottom: 6px; }
    input, select { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #d1d5db; margin-bottom: 15px; }
    input[type=color]{ height: 45px; padding: 4px; }
    button { width: 100%; padding: 14px; border-radius: 14px; border: none; font-weight: 700; cursor: pointer; }
    .primary { background: linear-gradient(135deg, #4f46e5, #9333ea); color: #fff; }
    .secondary { background:#10b981; color:#fff; margin-top:10px; }
    .qr-box { border:2px dashed #e5e7eb; border-radius:20px; padding:20px; min-height:340px; display:flex; flex-direction:column; align-items:center; justify-content:center; }
  </style>
</head>
<body>

<div class="container">
  <h1>مولّد رمز QR الذكي</h1>
  <p class="subtitle">معاينة لحظية + تدرّج لوني + خلفية شفافة</p>

  <div class="grid">
    <div>
      <label>النص أو الرابط</label>
      <input id="text" placeholder="https://example.com" oninput="liveUpdate()" />

      <label>الحجم</label>
      <select id="size" onchange="liveUpdate()">
        <option value="200">متوسط</option>
        <option value="300">كبير</option>
        <option value="400">كبير جدًا</option>
      </select>

      <label>لون البداية (تدرّج)</label>
      <input type="color" id="color1" value="#000000" oninput="liveUpdate()" />

      <label>لون النهاية (تدرّج)</label>
      <input type="color" id="color2" value="#4f46e5" oninput="liveUpdate()" />

      <label>الخلفية</label>
      <select id="bgMode" onchange="liveUpdate()">
        <option value="white">بيضاء</option>
        <option value="transparent">شفافة</option>
      </select>

      <button class="primary" onclick="generateQR()">إعادة التوليد</button>
    </div>

    <div class="qr-box">
      <canvas id="canvas"></canvas>
      <button class="secondary" onclick="downloadPNG()">تحميل PNG</button>
      <button class="secondary" onclick="downloadPDF()">تحميل PDF</button>
    </div>
  </div>
</div>

<script>
let baseQRCanvas = null;

function generateQR(){
  const text = document.getElementById('text').value.trim();
  if(!text){ return; }

  const size = parseInt(document.getElementById('size').value);
  const bgMode = document.getElementById('bgMode').value;

  const temp = document.createElement('div');
  new QRCode(temp, {
    text,
    width:size,
    height:size,
    colorDark:'#000000',
    colorLight: bgMode==='transparent' ? 'rgba(0,0,0,0)' : '#ffffff',
    correctLevel: QRCode.CorrectLevel.H
  });

  baseQRCanvas = temp.querySelector('canvas');
  repaintQR();
}

function repaintQR(){
  if(!baseQRCanvas) return;

  const size = parseInt(document.getElementById('size').value);
  const bgMode = document.getElementById('bgMode').value;
  const canvas = document.getElementById('canvas');
  canvas.width = size;
  canvas.height = size;

  const ctx = canvas.getContext('2d');
  ctx.clearRect(0,0,size,size);

  if(bgMode === 'white'){
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0,0,size,size);
  }

  const grad = ctx.createLinearGradient(0,0,size,size);
  grad.addColorStop(0, document.getElementById('color1').value);
  grad.addColorStop(1, document.getElementById('color2').value);

  ctx.drawImage(baseQRCanvas,0,0,size,size);
  ctx.// إصلاح مشكلة الكتلة الواحدة: نرسم التدرج ثم نطبّق قناع QR
ctx.clearRect(0,0,size,size);

// رسم التدرج
const grad = ctx.createLinearGradient(0,0,size,size);
grad.addColorStop(0, color1);
grad.addColorStop(1, color2);
ctx.fillStyle = grad;
ctx.fillRect(0,0,size,size);

// قناع QR (الحفاظ على المربعات)
ctx.globalCompositeOperation = 'destination-in';
ctx.drawImage(qrCanvas,0,0,size,size);
ctx.globalCompositeOperation = 'source-over'; = 'source-in';
  ctx.fillStyle = grad;
  ctx.fillRect(0,0,size,size);
  ctx.globalCompositeOperation = 'source-over';
}

function liveUpdate(){
  if(!baseQRCanvas){ generateQR(); return; }
  repaintQR();
}

function downloadPNG(){
  const canvas = document.getElementById('canvas');
  if(!canvas.width){ alert('أنشئ QR أولاً'); return; }
  const a = document.createElement('a');
  a.href = canvas.toDataURL('image/png');
  a.download = 'qr-code.png';
  a.click();
}

function downloadPDF(){
  const canvas = document.getElementById('canvas');
  if(!canvas.width){ alert('أنشئ QR أولاً'); return; }
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();
  const img = canvas.toDataURL('image/png');
  pdf.addImage(img,'PNG',20,20,170,170);
  pdf.save('qr-code.pdf');
}
</script>

</body>
</html>
